{"version":3,"sources":["BoardManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../assets/core/PrefabScript","sourcesContent":["const {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class NewClass extends cc.Component {\n    @property(cc.Prefab)\n    chessPiecePrefab: cc.Prefab = null;\n    \n    @property(cc.Node)\n    topSideHolder: cc.Node = null;\n\n    @property(cc.Node)\n    bottomSideHolder: cc.Node = null;\n\n    redColor: cc.Color;\n    blueColor: cc.Color;\n    chessPieces: any[];\n\n    protected onLoad(): void {\n        this.node.on('INIT_BOARD', this.initBoard, this);\n        this.node.on('CHESS_SELECT', this.onChessSelect, this);\n        this.node.on('CHESS_UNSELECT', this.onChessUnselect, this);\n\n        this.redColor = cc.Color.RED;\n        this.blueColor = cc.Color.BLUE;\n    }\n\n    initBoard() {\n        const { CHESS_LAYOUT, CHESS_INFO, CHESS_SIZE } = this.node.config;\n        this.chessPieces = [];\n\n        //init for the bottom side\n        for (let chessIndex = 0; chessIndex < CHESS_LAYOUT.length; chessIndex++) {\n            const chessName = CHESS_LAYOUT[chessIndex];\n            const chessPiece = cc.instantiate(this.chessPiecePrefab);\n            chessPiece.parent = this.bottomSideHolder;\n            chessPiece.sprite.color = this.redColor;\n            chessPiece.init(CHESS_INFO[chessName], chessName, CHESS_SIZE);\n            let position;\n            if (chessIndex > 5) {\n                position = this._getPosition(CHESS_INFO[chessName], true, true);\n            } else {\n                position = this._getPosition(CHESS_INFO[chessName], true);\n            }\n            chessPiece.setPosition(position);\n            this.chessPieces.push(chessPiece);\n        }\n\n        this.pawnIndex = 0;\n\n        //init for the top side\n        for (let chessIndex = 0; chessIndex < CHESS_LAYOUT.length; chessIndex++) {\n            const chessName = CHESS_LAYOUT[chessIndex];\n            const chessPiece = cc.instantiate(this.chessPiecePrefab);\n            chessPiece.parent = this.topSideHolder;\n            chessPiece.sprite.color = this.blueColor;\n            chessPiece.rotation = 180;\n            chessPiece.init(CHESS_INFO[chessName], chessName, CHESS_SIZE);\n            let position;\n            if (chessIndex > 5) {\n                position = this._getPosition(CHESS_INFO[chessName], false, true);\n            } else {\n                position = this._getPosition(CHESS_INFO[chessName], false);\n            }\n            chessPiece.setPosition(position);\n            this.chessPieces.push(chessPiece);\n        }\n    },\n}\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        chessPiecePrefab: cc.Prefab,\n        topSideHolder: cc.Node,\n        bottomSideHolder: cc.Node,\n    },\n\n    onLoad() {\n        \n    },\n\n    initBoard() {\n        const { CHESS_LAYOUT, CHESS_INFO, CHESS_SIZE } = this.node.config;\n        this.chessPieces = [];\n\n        //init for the bottom side\n        for (let chessIndex = 0; chessIndex < CHESS_LAYOUT.length; chessIndex++) {\n            const chessName = CHESS_LAYOUT[chessIndex];\n            const chessPiece = cc.instantiate(this.chessPiecePrefab);\n            chessPiece.parent = this.bottomSideHolder;\n            chessPiece.sprite.color = this.redColor;\n            chessPiece.init(CHESS_INFO[chessName], chessName, CHESS_SIZE);\n            let position;\n            if (chessIndex > 5) {\n                position = this._getPosition(CHESS_INFO[chessName], true, true);\n            } else {\n                position = this._getPosition(CHESS_INFO[chessName], true);\n            }\n            chessPiece.setPosition(position);\n            this.chessPieces.push(chessPiece);\n        }\n\n        this.pawnIndex = 0;\n\n        //init for the top side\n        for (let chessIndex = 0; chessIndex < CHESS_LAYOUT.length; chessIndex++) {\n            const chessName = CHESS_LAYOUT[chessIndex];\n            const chessPiece = cc.instantiate(this.chessPiecePrefab);\n            chessPiece.parent = this.topSideHolder;\n            chessPiece.sprite.color = this.blueColor;\n            chessPiece.rotation = 180;\n            chessPiece.init(CHESS_INFO[chessName], chessName, CHESS_SIZE);\n            let position;\n            if (chessIndex > 5) {\n                position = this._getPosition(CHESS_INFO[chessName], false, true);\n            } else {\n                position = this._getPosition(CHESS_INFO[chessName], false);\n            }\n            chessPiece.setPosition(position);\n            this.chessPieces.push(chessPiece);\n        }\n    },\n\n    _getPosition({ stepX = 0, stepY = 0, isPawn = false }, botSide, isReverse = false) {\n        const { STEP, BORDER_LEFT_BOARD, BORDER_TOP_BOARD, BORDER_BOTTOM_BOARD } = this.node.config;\n        if (botSide) {\n            if (isPawn) {\n                if (!this.pawnIndex) this.pawnIndex = 0;\n                const xPosition = BORDER_LEFT_BOARD + this.pawnIndex * STEP * 2;\n                const yPosition = BORDER_BOTTOM_BOARD + stepY * STEP;\n                this.pawnIndex++;\n                return new cc.v2(xPosition, yPosition); Ï\n            }\n\n            const xPosition = 0 + stepX * STEP;\n            const yPosition = BORDER_BOTTOM_BOARD + stepY * STEP;\n            if (isReverse) {\n                return new cc.v2(-xPosition, yPosition);\n            } else {\n                return new cc.v2(xPosition, yPosition);\n            }\n        } else {\n            if (isPawn) {\n                if (!this.pawnIndex) this.pawnIndex = 0;\n                const xPosition = BORDER_LEFT_BOARD + this.pawnIndex * STEP * 2;\n                const yPosition = BORDER_TOP_BOARD - stepY * STEP;\n                this.pawnIndex++;\n                return new cc.v2(xPosition, yPosition); Ï\n            }\n\n            const xPosition = 0 + stepX * STEP;\n            const yPosition = BORDER_TOP_BOARD - stepY * STEP;\n            if (isReverse) {\n                return new cc.v2(-xPosition, yPosition);\n            } else {\n                return new cc.v2(xPosition, yPosition);\n            }\n        }\n    },\n\n    onChessSelect(event) {\n        event.stopPropagation();\n        if (event.target === this.selectedChess && event.target !== null) {\n            this.selectedChess.emit('RESET');\n            this.selectedChess = null;\n            return;\n        }\n\n        if (!this.selectedChess) {\n            this.selectedChess = event.target;\n            return;\n        }\n\n        if (!this.targetChess) {\n            this.targetChess = event.target;\n\n        }\n    },\n\n    onChessUnselect(event) {\n        event.stopPropagation();\n        this.selectedChess = null;\n    },\n});\n"]}